<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KZMartMY - RM Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #0f1021; }
        .game-card { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); }
        @keyframes glow {
            0%, 100% { text-shadow: 0 0 5px #ff0000; }
            50% { text-shadow: 0 0 20px #ff0000, 0 0 30px #ff8800; }
        }
        .animate-glow { animation: glow 2s ease-in-out infinite; }
    </style>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>
<body class="text-gray-200">
    <div class="max-w-md mx-auto min-h-screen pb-20 p-4">
        <div class="flex justify-between items-center mb-6">
            <button onclick="logout()" class="text-xs bg-red-600/20 text-red-500 px-3 py-1 rounded-full border border-red-600/50">Logout</button>
            <div class="text-right">
                <p class="text-[10px] text-gray-400">Selamat Datang,</p>
                <p id="user-display" class="text-sm font-bold text-white">User</p>
            </div>
        </div>

        <div class="flex items-center space-x-3 mb-6 bg-gray-900/50 p-3 rounded-2xl border-l-4 border-red-600">
            <span class="animate-bounce">ðŸ”¥</span>
            <h2 class="text-lg font-black italic uppercase text-red-500 animate-glow">Popular Items</h2>
        </div>

        <div class="flex space-x-2 overflow-x-auto pb-4 no-scrollbar">
            <button onclick="displayGames('ALL')" class="bg-red-600 text-white px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap">ALL</button>
            <button onclick="displayGames('FISH IT')" class="bg-gray-800 text-gray-400 px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap">FISH IT</button>
            <button onclick="displayGames('REDFINGER')" class="bg-gray-800 text-gray-400 px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap">REDFINGER</button>
        </div>

        <div id="game-list" class="grid grid-cols-2 gap-4">
            </div>
    </div>

    <div id="variantModal" class="fixed inset-0 bg-black/90 z-[150] hidden flex items-center justify-center p-4">
        <div class="bg-[#1a1b3a] w-full max-w-sm rounded-2xl p-6 border border-gray-700">
            <h2 id="variantTitle" class="text-xl font-bold text-white mb-4 italic text-red-500">PILIH ITEM</h2>
            <div id="variantList" class="space-y-3 max-h-[60vh] overflow-y-auto"></div>
            <button onclick="closeVariantModal()" class="w-full mt-6 py-3 rounded-xl text-gray-400 font-bold bg-gray-800">Tutup</button>
        </div>
    </div>

    <script src="product.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAzqZNdN2Hq6gq7CqKsBRE7isgXZVFQChU",
            authDomain: "kzmart-auth.firebaseapp.com",
            projectId: "kzmart-auth",
            storageBucket: "kzmart-auth.firebasestorage.app",
            messagingSenderId: "1084515236820",
            appId: "1:1084515236820:web:582cb2a5cdb5181b5f9441",
            measurementId: "G-PV2MFPwMCZ"
        };
        firebase.initializeApp(firebaseConfig);

        firebase.auth().onAuthStateChanged((user) => {
            if (!user) { window.location.href = 'login.html'; }
            else { document.getElementById('user-display').innerText = user.email.split('@')[0]; }
        });

        function logout() { firebase.auth().signOut().then(() => { window.location.href = 'login.html'; }); }

        function displayGames(filter = 'ALL') {
            const list = document.getElementById('game-list');
            const data = window.allProducts || [];
            const filtered = filter === 'ALL' ? data : data.filter(p => p.category === filter);

            list.innerHTML = filtered.map(game => {
                const action = game.isVariant ? `openVariantModal(${game.id})` : `window.open('https://wa.me/60167481645?text=Nak%20beli%20${game.name}')`;
                return `
                    <div class="game-card rounded-2xl p-3 text-center border border-gray-800">
                        <img src="${game.img}" class="w-full h-20 object-contain mb-2">
                        <h3 class="text-[10px] font-bold text-gray-300 mb-2">${game.name}</h3>
                        <button onclick="${action}" class="w-full bg-red-600 py-2 rounded-lg text-[10px] font-bold text-white">
                            ${game.isVariant ? 'See Variants' : 'Buy Now'}
                        </button>
                    </div>`;
            }).join('');

            // Tukar warna butang aktif
            const buttons = document.querySelectorAll('button[onclick^="displayGames"]');
            buttons.forEach(btn => {
                if (btn.getAttribute('onclick').includes(`'${filter}'`)) {
                    btn.className = "bg-red-600 text-white px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap";
                } else {
                    btn.className = "bg-gray-800 text-gray-400 px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap";
                }
            });
        }

        function openVariantModal(id) {
            const product = window.allProducts.find(p => p.id === id);
            document.getElementById('variantTitle').innerText = product.name;
            document.getElementById('variantList').innerHTML = product.variants.map(v => `
                <button onclick="selectVariant('${v.name}')" class="w-full flex justify-between bg-[#0f1021] border border-gray-700 p-4 rounded-xl text-white text-sm">
                    <span>${v.name}</span>
                    <span class="text-red-500 font-bold">${v.isRate ? 'RATE' : 'RM'+v.price}</span>
                </button>`).join('');
            document.getElementById('variantModal').classList.remove('hidden');
        }

        function selectVariant(name) {
            closeVariantModal();
            window.open(`https://wa.me/60167481645?text=Nak%20beli%20${name}`);
        }

        function closeVariantModal() { document.getElementById('variantModal').classList.add('hidden'); }

        window.onload = () => { setTimeout(() => displayGames('ALL'), 500); };
    </script>
</body>
</html>